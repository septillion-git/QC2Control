<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QC3Control: QC3Control</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">QC3Control
   </div>
   <div id="projectbrief">A simple Arduino library to set the voltage of a Quick Charge 3.0 source</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="class_q_c3_control.html" title="Main class of the QC3Control-library. ">QC3Control</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Set the voltage of a Quick Charge 3.0 (class A) source via Arduino.</p>
<p>By Vincent Deconinck</p>
<p>All credits go to :</p><ul>
<li><a href="https://www.youtube.com/channel/UCHgeChD442K0ah-KxEg0PHw">Hugatry's HackVlog</a> because he came up with the idea and first code to control QC2.</li>
<li>Timo Engelgeer (Septillion) who made a nice wrapper for Quick Charge 2.0: <a href="https://github.com/septillion-git/QC2Control">QC2Control</a>. The <a class="el" href="class_q_c3_control.html" title="Main class of the QC3Control-library. ">QC3Control</a> project is just a fork of QC2Control adapted for Quick Charge3 while retaining maximum compatibility so it can be used as a drop-in replacement.</li>
</ul>
<h2>What does it do?</h2>
<p><a class="el" href="class_q_c3_control.html" title="Main class of the QC3Control-library. ">QC3Control</a> makes it possible to set the voltage (even on the fly) of a Quick Charge 3.0 source like a mains charger or power bank by simulating the behaviour of a QC3 portable device.</p>
<p>Currently, only QC3.0 class A (up to 12V) is supported. QC3.0 class B (up to 20V) should be a minor change, but due to the lack of hardware to test, the libary only targets class A for now. Consequently, possible voltages are 5V (USB default), 9V or 12V, plus any value between 3.6V and 12V obtained by 200mV steps from one of the 3 previous voltages.</p>
<p>Of course, to take advantage of this library, the source needs to support the <a href="https://www.qualcomm.com/products/features/quick-charge">Quick Charge 3.0</a> technology form <a href="https://www.qualcomm.com/">Qualcomm</a>. However, the library can also be used with a QC2.0 compatible charger if using only set5V(), set9V() and set12V().</p>
<h2>Differences between QC2Control and <a class="el" href="class_q_c3_control.html" title="Main class of the QC3Control-library. ">QC3Control</a></h2>
<p>QC3 chargers and battery packs should be backwards compatible with QC2, but I first had to adjust the resistor values compared to the ones in QC2Control. More information on <a href="http://blog.deconinck.info/post/2017/08/09/Turning-a-Quick-Charge-3.0-charger-into-a-variable-voltage-power-supply">my blog</a>.</p>
<p>Apart from that, the main protocol difference between QC2.0 and QC3.0 (class A) is the introduction of continuous voltages, plus the possibility to lower the voltage to 3.6V.</p>
<p>To reach QC3.0 continuous mode, D- must be set high, which can be achieved two ways:</p><ul>
<li>either by slightly modifying the QC2Control circuit and "disconnecting" the bottom resistor of the D- divider when needed. In that case, the divider acts as a pull up for USB D-. I call this circuit "legacy".</li>
<li>or by using a new circuit which basically duplicates the D+ configuration to the D- side: a divider between VCC and GND plus a third resistor to the Arduino "DM" pin. In that case, outputting a HIGH level to the third resistor, a voltage of 3.3V or more can be set on USB D-. This is the recommended circuit as it does not require an additional Arduino pin.</li>
</ul>
<p>Both circuits are supported by the library, but basically, I suggest you first try the recommended circuit, and if your QC3 charger refuses to generate anything else than 5V, then try with the legacy circuit, changing the constructor in the code accordingly.</p>
<h3>How to connect?</h3>
<p>As indicated above, the library supports the 2 following configurations. In all cases, all you need is a few resistors and (optionally) two diodes (see next section).</p>
<p>a) Recommended "2-wire" circuit.</p>
<div class="image">
<img src="recommended_circuit.png" alt="recommended_circuit.png"/>
<div class="caption">
QC3Control recommended circuit</div></div>
<p> b) Legacy "3-wire" circuit: Apart from the values, it is similar to the QC2Control circuit but requires a third Arduino pin instead of GND on the D- divider. Not recommended unless you have issues with the "2-wire" version</p>
<div class="image">
<img src="legacy_circuit.png" alt="legacy_circuit.png"/>
<div class="caption">
QC3Control circuit</div></div>
<p> The wire color for a normal USB-cable is:</p><ul>
<li>V<sub>BUS</sub>: Red</li>
<li>Data+: Green</li>
<li>Data-: White</li>
<li>GND: Black</li>
</ul>
<p>You're free to pick any pin on the Arduino, just be sure to point to the right pins in <a class="el" href="class_q_c3_control.html" title="Main class of the QC3Control-library. ">QC3Control()</a>.</p>
<h4>Diodes</h4>
<p>Although the regulator on a Arduino Pro Mini should be able to handle 12V (with a light load) some clones don't like 12V and release the <a href="https://en.wikipedia.org/wiki/Magic_smoke">magic smoke</a>. Adding two diodes will drop the voltage slightly (about 1.5V) so the Arduino can handle the voltage, even if it's set to 12V.</p>
<p>Because the Arduino can only provide a small current the small and cheap 1N4148 will do. But any other (non-Schottky) should work like a 1N4007 etc.</p>
<p>Warning though: Please note that if you add the diodes, you may not be able to reach lower voltages allowed by the QC3 specification (down to 3.6V) as the Arduino may not receive enough voltage.</p>
<p>If you have a multi-port QC3 charger, a good alternative to those diodes is to power the Arduino from one (possibily non-QC) port with 5V and use it to control the voltage of the another (QC3) port. In that case, don't forget to connect the GND of both ports together (but <b>NOT</b> their VCCs of cource).</p>
<h2>Download and install</h2>
<h3>Library manager</h3>
<p><a class="el" href="class_q_c3_control.html" title="Main class of the QC3Control-library. ">QC3Control</a> is available via Arduino IDE Library Manager.</p>
<ol type="1">
<li>Open the Arduino IDE (1.5 or above).</li>
<li>In the tool-bar click Sketch -&gt; Include Library -&gt; Manage Libraries...</li>
<li>Type in the search bar "QC3Control".</li>
<li>The latest version of <a class="el" href="class_q_c3_control.html" title="Main class of the QC3Control-library. ">QC3Control</a> should show.</li>
<li>Click on it and click Install.</li>
<li>Done!</li>
</ol>
<h3>GitHub</h3>
<p>Latest release: <b><a href="https://github.com/vdeconinck/QC3Control/archive/v1.3.0.zip">v1.3.0</a></b></p>
<ol type="1">
<li>Download the latest release.</li>
<li>Extract it to the <code>libraries</code> folder <b>inside</b> your Sketchbook. Default is <code>[user]\Arduino\libraries</code>.</li>
<li>Rename the folder to <code><a class="el" href="class_q_c3_control.html" title="Main class of the QC3Control-library. ">QC3Control</a></code> (remove version number).</li>
<li>Restart the Arduino IDE if you had it open.</li>
<li>Done!</li>
</ol>
<h3>Update</h3>
<p>You can update to the latest version of the library in the Library Manager as well.</p>
<ol type="1">
<li>Open the Arduino IDE (1.5 or above).</li>
<li>In the tool-bar click Sketch -&gt; Include Library -&gt; Manage Libraries...</li>
<li>Type in the search bar "QC3Control".</li>
<li>The <a class="el" href="class_q_c3_control.html" title="Main class of the QC3Control-library. ">QC3Control</a> library should show.</li>
<li><b>Click on it</b> and click Update.</li>
<li>Done!</li>
</ol>
<p>Alternatively you can download it from GitHub and simply unpack it over the current version (or remove the old version first).</p>
<h2>Usage</h2>
<p>Just see this simple sketch (assuming the recommended circuit is used) </p><div class="fragment"><div class="line">{C++}</div><div class="line">#include &lt;QC3Control.h&gt;</div><div class="line"></div><div class="line">//Pin 4 for Data+</div><div class="line">//Pin 5 for Data-</div><div class="line">//See How to connect in the documentation for more details.</div><div class="line">QC3Control quickCharge(4, 5);</div><div class="line"></div><div class="line">void setup() {</div><div class="line">  //Optional</div><div class="line">  //quickCharge.begin();</div><div class="line"></div><div class="line">  //set voltage to 12V</div><div class="line">  quickCharge.set12V();</div><div class="line"></div><div class="line">  delay(1000);</div><div class="line">}</div><div class="line"></div><div class="line">void loop() {</div><div class="line">  //And you can change it on the fly</div><div class="line">  delay(1000);</div><div class="line">  quickCharge.set9V();</div><div class="line">  delay(1000);</div><div class="line">  quickCharge.set5V();</div><div class="line">  delay(1000);</div><div class="line">  quickCharge.setVoltage(6);</div><div class="line">  delay(1000);</div><div class="line">  for (int i = 0; i &lt; 10; i++) quickCharge.decrementVoltage();</div><div class="line">  delay(1000);</div><div class="line">  quickCharge.set12V();</div><div class="line">}</div></div><!-- fragment --><p> <b>Please note</b>, delay() here is just used to demonstrate. Better not to stop the complete program with delay()'s.</p>
<p>If you can, place the call to begin() (or setVoltage()) at the end of the setup(). The handshake needs a fixed time but that already starts when the QC 3.0 source (and thus the Arduino) is turned on. So by doing begin() last you can do stuff while waiting.</p>
<h3>Constructors</h3>
<h4><a class="el" href="class_q_c3_control.html" title="Main class of the QC3Control-library. ">QC3Control(byte DpPin, byte DmPin)</a></h4>
<p>[QC2 or QC3 power source] This will create a <a class="el" href="class_q_c3_control.html" title="Main class of the QC3Control-library. ">QC3Control</a> object to control the voltage of the Quick Charge source when using the recommended "2-wire" circuit. DpPin is the pin number for the Data+ side, DmPin is the pin number for the Data- side. See <a href="#how-to-connect"><b>How to connect?</b></a>.</p>
<h4><a class="el" href="class_q_c3_control.html" title="Main class of the QC3Control-library. ">QC3Control(byte DpPin, byte DmPin, byte DmGndPin)</a></h4>
<p>[QC2 or QC3 power source] This will create a <a class="el" href="class_q_c3_control.html" title="Main class of the QC3Control-library. ">QC3Control</a> object to control the voltage of the Quick Charge 3.0 source when using the legacy "3-wire" circuit. DpPin is the pin number for the Data+ side, DmPin is the pin number for the upper resistor of the Data- side and DmGndPin is the pin number for the lower resistor of the Data- side. See <a href="#how-to-connect"><b>How to connect?</b></a>.</p>
<h3>Methods</h3>
<h4>void .begin()</h4>
<p>[QC2 or QC3 power source] Just does the handshake with the Quick Charge 3.0 source so it will accept commands for different voltage. It's not mandatory to call begin(), if it's not called before setting a voltage the library will call begin() at that moment.</p>
<h4>void .set5V(), .set9V() and .set12V()</h4>
<p>[QC2 or QC3 power source] Sets the desired voltage of the QC source using discrete (QC2) mode.</p>
<h4>void .setVoltage(double volt), setMilliVoltage(unsigned int milliVolt)</h4>
<p>[QC3 power source only] Sets the desired voltage of the QC3.0 source using continuous (QC3) mode. Setting an unreachable voltage will result in the closest supported voltage.</p>
<h4>double getVoltage(), unsigned int getMilliVoltage()</h4>
<p>[QC2 or QC3 power source] Return the last voltage that was requested, or the closest one in the range 3.6 - 12V.</p>
<p>Note that these methods return the value the library requested, not the actual voltage which may be different if the power source did not behave as exepected.</p>
<h4>void incrementVoltage(), decrementVoltage()</h4>
<p>[QC3 power source only] Requests an increment or decrement of the voltage by 0.2V</p>
<h2>Full documentation</h2>
<p>Full documentation of all the methods of this library can be found inside the library located in <code><a class="el" href="class_q_c3_control.html" title="Main class of the QC3Control-library. ">QC3Control</a>\doc</code>. Just open <code><a class="el" href="class_q_c3_control.html" title="Main class of the QC3Control-library. ">QC3Control</a>\doc\index.html</code> to see all methods of <a class="el" href="class_q_c3_control.html" title="Main class of the QC3Control-library. ">QC3Control</a>.</p>
<p>You can also view the documentation via <a href="https://htmlpreview.github.io/?https://github.com/vdeconinck/QC3Control/master/doc/index.html">GitHub HTML Preview</a>.</p>
<p>This documentation is powered by <a href="http://www.doxygen.org/">Doxygen</a> and thus fully extracted from the source files. This README.md is also used as Main Page.</p>
<h2>FAQ</h2>
<h3>Can I control more the one Quick Charge source with a single Arduino?</h3>
<p>Yes you can! Just make multiple <a class="el" href="class_q_c3_control.html" title="Main class of the QC3Control-library. ">QC3Control</a> objects connected to different pins. But be sure to connect GND of all power supplies (including QC3.0 sources) together but <b>not</b> the voltage rails. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
